<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KANBAN - GEST√ÉO DE ATIVIDADES CGF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background: #004aad;
      color: white;
      padding: 20px 0;
      font-size: 22px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    header img {
      height: 45px;
    }

    #kanban {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 15px;
      padding: 20px;
      flex-wrap: wrap;
    }

    .column {
      background: #ffffff;
      border-radius: 10px;
      padding: 15px;
      width: 270px;
      min-height: 400px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .column h2 {
      margin-top: 0;
      font-size: 18px;
      background: #004aad;
      color: white;
      padding: 10px;
      border-radius: 8px;
    }

    .task {
      background: #e9eef5;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: grab;
      text-align: left;
    }

    .task.dragging {
      opacity: 0.5;
    }

    button {
      margin: 10px 5px;
      padding: 10px 15px;
      background: #004aad;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #00347a;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
    }

    .modal-content {
      background: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      text-align: left;
    }

    .close {
      float: right;
      font-size: 22px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    <img src="logo.png" alt="Logo CGF">
    KANBAN - GEST√ÉO DE ATIVIDADES CGF
  </header>

  <div>
    <button onclick="openModal()">‚ûï Adicionar Tarefa</button>
    <button onclick="exportarWhatsApp()">üì≤ Compartilhar WhatsApp</button>
    <button onclick="exportarPDF()">üìÑ Exportar PDF</button>
  </div>

  <div id="kanban">
    <div class="column" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)">
      <h2>üî¥ A FAZER</h2>
    </div>

    <div class="column" id="doing" ondrop="drop(event)" ondragover="allowDrop(event)">
      <h2>üü° EM ANDAMENTO</h2>
    </div>

    <div class="column" id="review" ondrop="drop(event)" ondragover="allowDrop(event)">
      <h2>üîµ EM REVIS√ÉO</h2>
    </div>

    <div class="column" id="done" ondrop="drop(event)" ondragover="allowDrop(event)">
      <h2>üü¢ CONCLU√çDO</h2>
    </div>
  </div>

  <!-- Modal -->
  <div id="taskModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3 id="modalTitle">Adicionar Tarefa</h3>
      <label>T√≠tulo:</label>
      <input type="text" id="taskTitle" style="width:100%">
      <label>Descri√ß√£o:</label>
      <textarea id="taskDesc" rows="3" style="width:100%"></textarea>
      <label>Respons√°vel:</label>
      <input type="text" id="taskResp" style="width:100%">
      <label>Prazo:</label>
      <input type="date" id="taskDate" style="width:100%">
      <button id="saveTaskBtn" onclick="saveTask()">Salvar</button>
    </div>
  </div>

  <script>
    let editingTask = null;

    function openModal(task = null) {
      document.getElementById('taskModal').style.display = 'block';
      document.getElementById('modalTitle').innerText = task ? 'Editar Tarefa' : 'Adicionar Tarefa';
      editingTask = task;
      if (task) {
        document.getElementById('taskTitle').value = task.querySelector('h4').innerText;
        document.getElementById('taskDesc').value = task.querySelector('p').innerText;
        document.getElementById('taskResp').value = task.querySelector('.responsavel').innerText.replace('üë§ ', '');
        document.getElementById('taskDate').value = task.querySelector('.prazo').innerText.replace('üìÖ ', '');
      } else {
        document.getElementById('taskTitle').value = '';
        document.getElementById('taskDesc').value = '';
        document.getElementById('taskResp').value = '';
        document.getElementById('taskDate').value = '';
      }
    }

    function closeModal() {
      document.getElementById('taskModal').style.display = 'none';
    }

    function saveTask() {
      const title = document.getElementById('taskTitle').value;
      const desc = document.getElementById('taskDesc').value;
      const resp = document.getElementById('taskResp').value;
      const date = document.getElementById('taskDate').value;

      if (!title) return alert('Preencha o t√≠tulo da tarefa.');

      if (editingTask) {
        editingTask.querySelector('h4').innerText = title;
        editingTask.querySelector('p').innerText = desc;
        editingTask.querySelector('.responsavel').innerText = 'üë§ ' + resp;
        editingTask.querySelector('.prazo').innerText = 'üìÖ ' + date;
      } else {
        const task = document.createElement('div');
        task.className = 'task';
        task.draggable = true;
        task.innerHTML = `<h4>${title}</h4><p>${desc}</p><div class='responsavel'>üë§ ${resp}</div><div class='prazo'>üìÖ ${date}</div>`;
        task.addEventListener('dblclick', () => openModal(task));
        task.addEventListener('dragstart', drag);
        document.getElementById('todo').appendChild(task);
      }
      closeModal();
      saveTasksToLocalStorage();
    }

    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) { ev.dataTransfer.setData('text', ev.target.outerHTML); ev.target.remove(); }
    function drop(ev) {
      ev.preventDefault();
      const data = ev.dataTransfer.getData('text');
      ev.target.closest('.column').innerHTML += data;
      saveTasksToLocalStorage();
    }

    function saveTasksToLocalStorage() {
      const kanbanData = {};
      document.querySelectorAll('.column').forEach(col => {
        kanbanData[col.id] = col.innerHTML;
      });
      localStorage.setItem('kanbanData', JSON.stringify(kanbanData));
    }

    function loadTasksFromLocalStorage() {
      const data = JSON.parse(localStorage.getItem('kanbanData'));
      if (data) {
        for (const id in data) {
          document.getElementById(id).innerHTML = data[id];
        }
        document.querySelectorAll('.task').forEach(task => {
          task.addEventListener('dblclick', () => openModal(task));
          task.addEventListener('dragstart', drag);
        });
      }
    }

    function exportarWhatsApp() {
      let texto = 'üìã *KANBAN - GEST√ÉO DE ATIVIDADES CGF*\nAtualizado em: ' + new Date().toLocaleDateString('pt-BR') + '\n\n';
      document.querySelectorAll('.column').forEach(col => {
        const titulo = col.querySelector('h2').innerText;
        const tarefas = col.querySelectorAll('.task');
        texto += titulo + ` (${tarefas.length})\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
        tarefas.forEach(t => {
          texto += `üìù ${t.querySelector('h4').innerText}\n${t.querySelector('p').innerText}\n${t.querySelector('.responsavel').innerText}\n${t.querySelector('.prazo').innerText}\n\n`;
        });
      });
      texto += 'Relat√≥rio gerado automaticamente pelo Sistema Kanban CGF';
      window.open(`https://wa.me/?text=${encodeURIComponent(texto)}`);
    }

    function exportarPDF() {
      const conteudo = document.getElementById('kanban').innerHTML;
      const janela = window.open('', '_blank');
      janela.document.write(`<html><head><title>Relat√≥rio Kanban</title>
      <style>
        body { font-family: Arial; }
        .column { border:1px solid #ccc; border-radius:10px; padding:10px; margin:10px; }
        h2 { background:#004aad; color:white; padding:5px; border-radius:6px; }
        .task { background:#e9eef5; padding:8px; border-radius:8px; margin-bottom:8px; }
      </style></head><body>${conteudo}</body></html>`);
      janela.print();
    }

    loadTasksFromLocalStorage();
  </script>
</body>
</html>
